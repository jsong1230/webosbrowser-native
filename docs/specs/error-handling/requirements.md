# 에러 처리 — 요구사항 분석서

## 1. 개요

### 기능명
에러 처리 (Error Handling)

### 목적
웹 페이지 로딩 중 발생하는 다양한 에러(네트워크 연결 실패, 404 에러, 렌더링 오류, 타임아웃 등)를 감지하고, 사용자 친화적인 에러 화면을 표시하여 사용자가 문제를 이해하고 쉽게 복구할 수 있도록 합니다.

### 대상 사용자
- 프로젝터 대화면에서 웹 브라우저를 사용하는 모든 사용자
- 네트워크 불안정 환경에서 웹 서핑하는 사용자
- 리모컨만으로 브라우저를 조작하는 사용자

### 요청 배경
- **네트워크 불안정**: 가정 환경에서 Wi-Fi 연결 불안정 또는 ISP 장애 발생 가능
- **404/500 에러**: 사용자가 잘못된 URL 입력 또는 서버 오류 페이지 접속
- **CORS 제약**: webOS iframe의 Same-Origin Policy로 인한 렌더링 제약
- **타임아웃**: 대용량 페이지 또는 느린 서버로 인한 로딩 지연
- **사용자 경험**: 기본 브라우저 에러 화면은 리모컨 조작 불가 또는 가독성 낮음

현재 WebView 컴포넌트에 기본적인 에러 처리가 구현되어 있으나, 에러 타입별 세분화된 처리와 전용 ErrorPage 컴포넌트가 필요합니다.

---

## 2. 기능 요구사항 (Functional Requirements)

### FR-1: 에러 감지
- **설명**: iframe의 `onError` 이벤트 및 타임아웃 타이머로 에러를 감지합니다.
- **유저 스토리**: As a 사용자, I want 브라우저가 페이지 로딩 실패를 자동으로 감지하고, so that 무한 대기 상태에 빠지지 않습니다.
- **우선순위**: Must
- **세부 사항**:
  - iframe의 `onError` 이벤트 리스닝 (네트워크 에러, DNS 실패 등)
  - 30초 타임아웃 타이머 (현재 WebView 구현에 존재)
  - 에러 발생 시 WebView 상태를 `error`로 전환
  - 에러 정보 객체 생성 (errorCode, errorMessage, url)

### FR-2: 에러 타입 분류
- **설명**: 에러를 타입별로 분류하여 각기 다른 메시지와 복구 옵션을 제공합니다.
- **유저 스토리**: As a 사용자, I want 에러 유형에 따라 적절한 안내 메시지를 보고, so that 문제 해결 방법을 이해할 수 있습니다.
- **우선순위**: Must
- **에러 타입**:
  | 에러 타입 | 에러 코드 | 원인 | 메시지 예시 |
  |----------|----------|------|------------|
  | 네트워크 에러 | `-1` | DNS 실패, 연결 거부, 네트워크 단절 | "네트워크 연결을 확인해주세요" |
  | 타임아웃 에러 | `-2` | 30초 초과 로딩 | "페이지 로딩 시간이 초과되었습니다 (30초)" |
  | 404 에러 | `404` | 페이지 없음 | "페이지를 찾을 수 없습니다" |
  | 5xx 에러 | `500`, `503` | 서버 오류 | "서버에 일시적인 문제가 발생했습니다" |
  | CORS 에러 | `-3` | Same-Origin Policy 위반 | "이 페이지는 보안 정책으로 인해 표시할 수 없습니다" |
  | 알 수 없는 에러 | `-99` | 기타 | "페이지 로딩 중 오류가 발생했습니다" |

### FR-3: 에러 화면 UI
- **설명**: 에러 발생 시 WebView 위에 오버레이 형태로 에러 화면을 표시합니다.
- **유저 스토리**: As a 사용자, I want 에러 발생 시 명확한 안내 화면을 보고, so that 현재 상황을 이해할 수 있습니다.
- **우선순위**: Must
- **UI 요소**:
  - 에러 아이콘 (⚠️ 또는 ❌) - 대형 아이콘 (80x80px)
  - 에러 제목 (예: "페이지 로딩 실패", "연결 실패")
  - 에러 메시지 (원인 설명)
  - 실패한 URL 표시 (축약 URL, 최대 50자)
  - 재시도 버튼 (Spotlight 포커스 가능)
  - 홈으로 이동 버튼 (선택 사항)
  - 배경: 반투명 검은색 오버레이 (opacity 0.9)

### FR-4: 재시도 기능
- **설명**: 재시도 버튼 클릭 시 같은 URL로 다시 로딩을 시도합니다.
- **유저 스토리**: As a 사용자, I want 에러 화면에서 재시도 버튼을 누르고, so that 네트워크 복구 후 페이지를 다시 로드할 수 있습니다.
- **우선순위**: Must
- **세부 사항**:
  - 재시도 버튼 클릭 시 iframe src를 다시 설정하여 로딩 재시작
  - WebView 상태를 `error` → `loading`으로 전환
  - 재시도 횟수 제한 없음 (사용자가 원하는 만큼 재시도 가능)
  - 재시도 시 에러 화면 즉시 제거, 로딩 인디케이터 표시

### FR-5: 홈으로 이동 기능
- **설명**: 에러 화면에서 홈 버튼 클릭 시 홈페이지로 이동합니다.
- **유저 스토리**: As a 사용자, I want 에러 발생 시 홈페이지로 돌아가고, so that 다른 페이지를 탐색할 수 있습니다.
- **우선순위**: Should
- **세부 사항**:
  - 홈 버튼 클릭 시 homeUrl로 이동 (기본값: `https://www.google.com`)
  - WebView 상태를 `error` → `loading`으로 전환
  - NavigationBar의 홈 버튼과 동일한 동작

### FR-6: 에러 로깅
- **설명**: 에러 발생 시 로그를 기록하여 디버깅 및 모니터링에 활용합니다.
- **유저 스토리**: As a 개발자, I want 에러 발생 시 상세 로그를 확인하고, so that 문제 원인을 파악할 수 있습니다.
- **우선순위**: Must
- **로그 정보**:
  - 타임스탬프
  - 에러 코드
  - 에러 메시지
  - 실패한 URL
  - 로딩 시작 시간 및 소요 시간
  - 사용자 환경 정보 (webOS 버전, 네트워크 상태 등)

### FR-7: 에러 이벤트 콜백
- **설명**: 에러 발생 시 부모 컴포넌트(BrowserView)에 에러 정보를 전달합니다.
- **유저 스토리**: As a BrowserView, I want WebView에서 에러가 발생하면 알림을 받고, so that 탭 상태를 업데이트할 수 있습니다.
- **우선순위**: Must
- **콜백 인터페이스**:
  ```javascript
  onLoadError({ errorCode, errorMessage, url })
  ```
- **사용 사례**:
  - BrowserView에서 탭의 `isError` 상태 업데이트
  - 에러 통계 수집 (향후 분석용)

### FR-8: 리모컨 포커스 관리
- **설명**: 에러 화면의 버튼들은 Spotlight 포커스로 리모컨 조작이 가능해야 합니다.
- **유저 스토리**: As a 사용자, I want 리모컨 방향키로 에러 화면의 버튼을 선택하고, so that 재시도 또는 홈으로 이동할 수 있습니다.
- **우선순위**: Must
- **포커스 흐름**:
  - 에러 화면 표시 시 재시도 버튼에 자동 포커스
  - 좌/우 방향키: 재시도 ↔ 홈 버튼 전환
  - 선택 버튼: 버튼 실행
  - Back 키: 에러 화면 유지 (NavigationBar로 포커스 이동 불가)

---

## 3. 비기능 요구사항 (Non-Functional Requirements)

### 성능
- **에러 감지 속도**: 에러 발생 후 500ms 이내 에러 화면 표시
- **타임아웃 시간**: 30초 (현재 WebView 구현 유지)
- **재시도 응답 시간**: 버튼 클릭 후 300ms 이내 로딩 시작

### UX (리모컨 최적화)
- **대화면 가독성**:
  - 에러 제목: 폰트 크기 48px, 굵은 글꼴
  - 에러 메시지: 폰트 크기 28px, 일반 글꼴
  - URL: 폰트 크기 22px, 회색 텍스트
  - 버튼: 최소 크기 200x60px, 폰트 크기 24px
- **고대비 디자인**:
  - 배경: 반투명 검은색 (rgba(0, 0, 0, 0.9))
  - 텍스트: 흰색 (#FFFFFF)
  - 버튼: 파란색 배경 (#1E90FF), 흰색 텍스트
  - 포커스: 노란색 테두리 (4px solid #FFD700)
- **애니메이션**:
  - 에러 화면 페이드인 (300ms)
  - 재시도 시 페이드아웃 (200ms)

### 접근성
- **리모컨 전용 조작**: 모든 버튼은 Spotlight Spottable 컴포넌트 사용
- **명확한 피드백**: 버튼 클릭 시 시각적 피드백 (버튼 크기 확대 또는 색상 변경)
- **에러 메시지 국제화**: 향후 다국어 지원 대비 (현재는 한국어만)

### 보안
- **에러 정보 노출 최소화**: 에러 메시지에 서버 내부 정보(스택 트레이스, IP 등) 노출 금지
- **URL 검증**: 에러 화면에 표시할 URL은 최대 50자로 제한 (XSS 방지)

### 확장성
- **커스텀 에러 핸들러**: ErrorPage 컴포넌트에 커스텀 에러 타입 및 메시지 전달 가능
- **에러 리포팅**: 향후 원격 로그 수집 시스템 연동 가능 (현재는 로컬 로그만)

---

## 4. 제약조건

### webOS 플랫폼 제약
- **iframe 에러 이벤트 제한**: iframe의 `onError` 이벤트는 네트워크 에러만 감지 가능, HTTP 상태 코드(404, 500 등)는 감지 불가
- **CORS 제약**: Same-Origin Policy로 인해 cross-origin iframe의 응답 상태 코드 접근 불가
- **타임아웃 구현**: 브라우저 기본 타임아웃이 없으므로 JavaScript 타이머로 직접 구현 필요

### 기존 시스템 연동
- **WebView 컴포넌트 수정**: 현재 WebView 컴포넌트에 기본 에러 처리가 있으나, ErrorPage 컴포넌트를 별도로 분리하여 재사용성 향상
- **BrowserView 상태 관리**: 탭의 `isError` 상태를 TabContext에 반영하여 탭 전환 시 에러 상태 유지
- **NavigationBar 연동**: 에러 발생 시 NavigationBar의 뒤로/앞으로 버튼 비활성화 또는 에러 상태 표시

### 디자인 제약
- **Moonstone UI 스타일 준수**: 버튼, 폰트는 Enact Moonstone 테마 스타일 가이드를 따름
- **다크 모드 지원**: 향후 F-11 설정 화면에서 테마 전환 시 에러 화면도 다크/라이트 모드 적용

---

## 5. 용어 정의

| 용어 | 정의 |
|------|------|
| **에러 감지** | iframe의 onError 이벤트 또는 타임아웃 타이머로 로딩 실패를 감지하는 프로세스 |
| **에러 타입** | 네트워크 에러, 타임아웃, 404, 5xx, CORS 등 에러의 원인 분류 |
| **에러 화면** | 에러 발생 시 WebView 위에 오버레이로 표시되는 UI (ErrorPage 컴포넌트) |
| **재시도** | 같은 URL로 페이지 로딩을 다시 시도하는 동작 |
| **타임아웃** | 페이지 로딩 시작 후 30초 이내 완료되지 않으면 에러로 처리 |
| **에러 로깅** | 에러 발생 시 로그 메시지를 기록하는 동작 (logger.js 사용) |
| **에러 콜백** | WebView에서 BrowserView로 에러 정보를 전달하는 PropTypes 함수 |
| **Spottable** | Enact Spotlight 시스템에서 리모컨 포커스를 받을 수 있는 컴포넌트 |
| **오버레이** | 기존 WebView 위에 반투명 배경으로 덮어 표시하는 레이어 |
| **CORS** | Cross-Origin Resource Sharing, Same-Origin Policy로 인한 cross-origin 접근 제약 |

---

## 6. 범위 외 (Out of Scope)

### 이번 기능에서 하지 않는 것
- **HTTP 상태 코드 감지**: iframe 제약으로 인해 404, 500 등 HTTP 상태 코드를 직접 감지 불가 (서버에서 에러 페이지로 리다이렉트 시 정상 페이지로 간주)
- **자동 재시도**: 에러 발생 시 자동으로 재시도하지 않음 (사용자가 수동으로 재시도 버튼 클릭)
- **에러 통계**: 에러 발생 빈도, 원인 통계를 수집하지 않음 (향후 F-15 이후 확장 가능)
- **오프라인 모드**: 네트워크 단절 시 오프라인 페이지 제공하지 않음 (단순 에러 화면만 표시)
- **에러 복구 제안**: "Wi-Fi를 켜세요", "라우터를 재시작하세요" 등의 구체적인 복구 제안 제공하지 않음
- **에러 히스토리**: 이전에 발생한 에러 기록을 별도로 저장하지 않음 (로그만 기록)

---

## 7. 수용 기준 (Acceptance Criteria)

### AC-1: 네트워크 에러 감지 및 화면 표시
- Given: 사용자가 잘못된 URL을 입력하거나 네트워크가 단절된 상태
- When: WebView가 페이지 로딩 시도 시
- Then:
  - iframe onError 이벤트가 트리거됨
  - WebView 상태가 `error`로 전환됨
  - 에러 화면이 오버레이로 표시됨 (에러 아이콘, 제목, 메시지, URL, 재시도 버튼)
  - 에러 로그가 기록됨

### AC-2: 타임아웃 에러 처리
- Given: 사용자가 매우 느린 웹사이트에 접속
- When: 페이지 로딩 시작 후 30초 경과
- Then:
  - 타임아웃 타이머가 트리거됨
  - WebView 상태가 `error`로 전환됨
  - 에러 화면에 "페이지 로딩 시간이 초과되었습니다 (30초)" 메시지 표시
  - 재시도 버튼 클릭 시 다시 30초 타이머 시작

### AC-3: 재시도 버튼 동작
- Given: 에러 화면이 표시된 상태
- When: 사용자가 리모컨으로 재시도 버튼을 선택하고 확인 버튼을 누름
- Then:
  - 에러 화면이 페이드아웃 (200ms)
  - WebView 상태가 `loading`으로 전환됨
  - LoadingBar가 표시됨
  - 같은 URL로 페이지 로딩 재시도
  - 성공 시 에러 화면 제거, 실패 시 다시 에러 화면 표시

### AC-4: 홈으로 이동 버튼 동작
- Given: 에러 화면이 표시된 상태
- When: 사용자가 홈 버튼을 선택하고 확인 버튼을 누름
- Then:
  - 에러 화면이 페이드아웃 (200ms)
  - WebView 상태가 `loading`으로 전환됨
  - 홈페이지 URL로 페이지 로딩 시작
  - 성공 시 에러 화면 제거

### AC-5: 리모컨 포커스 관리
- Given: 에러 화면이 표시된 상태
- When: 에러 화면이 처음 표시됨
- Then:
  - 재시도 버튼에 자동 포커스됨 (노란색 테두리)
- When: 사용자가 좌/우 방향키를 누름
- Then:
  - 재시도 버튼 ↔ 홈 버튼 간 포커스 전환
- When: 사용자가 백 키를 누름
- Then:
  - 에러 화면이 유지됨 (포커스 이탈 불가)

### AC-6: 에러 로깅
- Given: 에러가 발생한 상태
- When: 에러 화면이 표시됨
- Then:
  - logger.error()로 에러 정보 기록됨
  - 로그에 타임스탬프, 에러 코드, 에러 메시지, URL, 소요 시간 포함

### AC-7: 탭 상태 반영
- Given: WebView에서 에러가 발생함
- When: onLoadError 콜백이 호출됨
- Then:
  - BrowserView가 TabContext의 `isError: true`로 업데이트
  - 탭을 전환하고 다시 돌아와도 에러 화면이 유지됨

### AC-8: 대화면 가독성
- Given: 에러 화면이 표시된 상태
- When: 사용자가 3m 거리에서 프로젝터 화면을 봄
- Then:
  - 에러 제목이 명확하게 읽힘 (48px 폰트)
  - 에러 메시지가 명확하게 읽힘 (28px 폰트)
  - 버튼이 명확하게 구분됨 (200x60px 크기)
  - 포커스 테두리가 명확하게 보임 (4px 노란색)

### AC-9: 에러 타입별 메시지
- Given: 각기 다른 타입의 에러가 발생함
- When: 에러 화면이 표시됨
- Then:
  - 네트워크 에러 (-1): "네트워크 연결을 확인해주세요"
  - 타임아웃 (-2): "페이지 로딩 시간이 초과되었습니다 (30초)"
  - 알 수 없는 에러 (-99): "페이지 로딩 중 오류가 발생했습니다"

### AC-10: 에러 화면 애니메이션
- Given: 에러가 발생함
- When: 에러 화면이 표시됨
- Then:
  - 페이드인 애니메이션 (300ms)
- When: 재시도 또는 홈 버튼을 누름
- Then:
  - 페이드아웃 애니메이션 (200ms)

---

## 8. 변경 이력

| 날짜 | 변경 내용 | 사유 |
|------|----------|------|
| 2026-02-13 | 초안 작성 | F-10 요구사항 분석 |

---

## 다음 단계

이 요구사항 분석서를 기반으로 architect 에이전트가 다음 문서를 작성합니다:
- `docs/specs/error-handling/design.md` (기술 설계서)
