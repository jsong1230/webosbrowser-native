# F-13: 리모컨 단축키 — 요구사항 분석서

## 1. 개요

- **기능명**: 리모컨 단축키 (Remote Control Shortcuts)
- **목적**: webOS 리모컨의 채널 버튼, 컬러 버튼 등을 활용하여 브라우저 주요 기능에 빠르게 접근할 수 있도록 함
- **대상 사용자**: LG 프로젝터 HU175QW 리모컨을 사용하는 모든 사용자
- **요청 배경**:
  - 현재 주요 기능(탭 전환, 북마크, 히스토리 등)은 NavigationBar의 버튼을 통해서만 접근 가능
  - 리모컨의 채널 버튼, 컬러 버튼 등 유휴 버튼을 활용하면 UX 개선 가능
  - webOS TV 플랫폼 사용자들이 익숙한 단축키 패턴 제공

---

## 2. 기능 요구사항 (Functional Requirements)

### 현재 구현 상태 (useRemoteControl.js)

#### 이미 구현된 키 매핑
| 키 | keyCode | 현재 동작 | 컨텍스트 |
|------|---------|----------|----------|
| Back (Backspace) | 8 또는 461 | WebView 포커스 시: 브라우저 뒤로가기<br>NavigationBar 포커스 시: Spotlight 포커스 이탈 | 전역 |
| Yellow (노란색 컬러 버튼) | 405 또는 406 | 다운로드 패널 열기 (F-12) | 전역 |

### FR-1: 채널 버튼을 통한 탭 전환

- **설명**: 리모컨의 채널 Up/Down 버튼으로 탭 간 빠른 전환 제공
- **유저 스토리**: As a 프로젝터 사용자, I want 채널 버튼으로 탭을 전환하고 싶다, so that 복잡한 Spotlight 네비게이션 없이 빠르게 탭을 이동할 수 있다
- **우선순위**: Must
- **키 매핑**:
  - Channel Up (keyCode 427): 이전 탭으로 전환
  - Channel Down (keyCode 428): 다음 탭으로 전환
- **동작 상세**:
  - 탭 목록을 순환 (마지막 탭 → 첫 탭, 첫 탭 → 마지막 탭)
  - 탭 전환 시 자동으로 WebView에 포커스
  - 탭이 1개만 있을 때는 무시
- **제약조건**:
  - F-06 (탭 관리 시스템) 의존
  - TabContext의 TAB_ACTIONS.SWITCH_TAB 사용

### FR-2: 컬러 버튼을 통한 주요 기능 접근

- **설명**: 리모컨의 Red/Green/Blue 컬러 버튼에 주요 기능 매핑
- **유저 스토리**: As a 프로젝터 사용자, I want 컬러 버튼으로 자주 쓰는 기능에 빠르게 접근하고 싶다, so that NavigationBar를 탐색하는 시간을 절약할 수 있다
- **우선순위**: Must
- **키 매핑**:
  - Red (keyCode 403 또는 404): 북마크 패널 열기 (F-07)
  - Green (keyCode 405 또는 406): 히스토리 패널 열기 (F-08)
  - Blue (keyCode 407 또는 408): 새 탭 생성 (F-06)
  - Yellow (keyCode 405 또는 406): 다운로드 패널 열기 (F-12) — **이미 구현됨**
- **동작 상세**:
  - 각 패널 열기 시 자동으로 패널에 포커스
  - 패널이 이미 열려있을 때는 무시 (중복 열기 방지)
  - 새 탭 생성 시 최대 탭 수(5개) 제한 체크
- **제약조건**:
  - F-06 (탭 관리), F-07 (북마크), F-08 (히스토리), F-12 (다운로드) 의존
  - BrowserView의 상태 관리 함수 사용 (setShowBookmarkPanel, handleNewTab 등)
- **주의사항**:
  - **Yellow 버튼 충돌 문제**:
    - features.md에는 Yellow → 북마크 추가로 명시되어 있음
    - 하지만 useRemoteControl.js에는 이미 Yellow → 다운로드 패널 열기로 구현됨
    - **해결 방안**: Green을 히스토리 패널로 재할당 (Yellow는 다운로드 유지)

### FR-3: 숫자 버튼을 통한 직접 탭 선택

- **설명**: 리모컨의 숫자 버튼(1~5)으로 특정 탭에 즉시 접근
- **유저 스토리**: As a 프로젝터 사용자, I want 숫자 버튼으로 원하는 탭에 바로 이동하고 싶다, so that 여러 번 채널 버튼을 누르지 않아도 된다
- **우선순위**: Should
- **키 매핑**:
  - 1~5 (keyCode 49~53): 해당 인덱스의 탭으로 이동 (1 = 첫 번째 탭, 5 = 다섯 번째 탭)
- **동작 상세**:
  - 탭이 존재하지 않는 숫자를 입력하면 무시 (예: 탭 3개일 때 4 입력 시 무시)
  - 이미 활성화된 탭 번호 입력 시 무시
  - 탭 전환 시 WebView에 포커스
- **제약조건**:
  - 최대 탭 수가 5개이므로 1~5 버튼만 사용
  - URLBar의 가상 키보드가 열려있을 때는 동작하지 않음 (키보드 입력 우선)

### FR-4: 재생 컨트롤 버튼 (Play/Pause) 매핑

- **설명**: 리모컨의 재생 버튼으로 페이지 스크롤 제어
- **유저 스토리**: As a 프로젝터 사용자, I want 재생 버튼으로 페이지를 스크롤하고 싶다, so that 긴 문서를 편하게 읽을 수 있다
- **우선순위**: Could
- **키 매핑**:
  - Play/Pause (keyCode 415 또는 19): 자동 스크롤 시작/멈춤 (WebView 컨텍스트)
  - FastForward (keyCode 417): 페이지 끝으로 스크롤
  - Rewind (keyCode 412): 페이지 맨 위로 스크롤
- **동작 상세**:
  - WebView에 포커스가 있을 때만 동작
  - 자동 스크롤은 초당 100px 속도로 부드럽게 이동
  - Play 상태에서 다시 Pause 누르면 스크롤 멈춤
- **제약조건**:
  - CORS 정책으로 일부 사이트에서는 동작하지 않을 수 있음
  - iframe contentWindow 접근 가능 여부 체크 필요

### FR-5: 설정 버튼 매핑

- **설명**: 리모컨의 설정/메뉴 버튼으로 브라우저 설정 화면 접근
- **유저 스토리**: As a 프로젝터 사용자, I want 설정 버튼으로 브라우저 설정에 빠르게 접근하고 싶다, so that NavigationBar를 거치지 않아도 된다
- **우선순위**: Should
- **키 매핑**:
  - Menu/Settings (keyCode 457 또는 18): 설정 패널 열기 (F-11)
- **동작 상세**:
  - 설정 패널 열기 시 자동으로 포커스
  - 패널이 이미 열려있을 때는 무시
- **제약조건**:
  - F-11 (설정 화면) 의존

---

## 3. 비기능 요구사항 (Non-Functional Requirements)

### NFR-1: 반응 속도
- 리모컨 키 입력 후 0.3초 이내 반응 (시각적 피드백)
- 탭 전환 애니메이션은 0.5초 이내 완료
- 중복 입력 방지: 0.5초 이내 동일 키 재입력 무시 (디바운스)

### NFR-2: 키 충돌 방지
- URLBar 가상 키보드가 열려있을 때는 채널/컬러 버튼 동작 안 함 (키보드 입력 우선)
- 패널이 열려있을 때는 패널 내부 Spotlight 네비게이션이 우선
- Back 키는 기존 동작 유지 (뒤로가기/패널 닫기)

### NFR-3: Spotlight 시스템 호환성
- 단축키 동작 후 Spotlight 포커스가 적절한 요소로 이동
- 기존 Spotlight 네비게이션과 충돌하지 않음
- 포커스 이동 시 Enact의 Spotlight 애니메이션 활용

### NFR-4: 확장성
- 새로운 키 매핑 추가 시 기존 코드 수정 최소화
- KeyboardHandler 서비스로 키 매핑 로직을 중앙화
- 키 코드 상수는 별도 파일로 관리 (keyCodeConstants.js)

### NFR-5: 디버깅 지원
- 리모컨 키 입력 시 logger.debug로 keyCode 기록
- 키 매핑 실패 시 경고 로그 출력
- 개발자 모드에서 키 코드 인식 테스트 도구 제공 (선택적)

---

## 4. 제약조건

### webOS 리모컨 키코드 제약사항
- webOS 기기별로 keyCode가 다를 수 있음 (예: Yellow 버튼 405 또는 406)
- 일부 키는 시스템 레벨에서 예약되어 있어 앱에서 오버라이드 불가
- 숫자 키(0~9)는 항상 사용 가능하지만, 특수 기능 키는 기기 펌웨어 버전에 따라 상이

### Spotlight 포커스 시스템 제약
- Spotlight 컨테이너가 아닌 영역에 포커스가 있을 때 키 이벤트가 무시될 수 있음
- WebView에 포커스가 있을 때 일부 키는 웹 페이지로 전달됨 (preventDefault 필요)

### CORS 및 보안 정책
- iframe contentWindow 접근이 제한된 사이트에서는 스크롤 제어 불가
- HTTPS 사이트와 HTTP 사이트 간 동작 차이 발생 가능

### 성능 제약
- 자동 스크롤 시 프레임 드롭 최소화 (requestAnimationFrame 사용)
- 탭 전환 시 렌더링 지연 방지 (메모리 관리)

---

## 5. 용어 정의

| 용어 | 정의 |
|------|------|
| **Channel Button** | 리모컨의 채널 Up/Down 버튼 (TV 채널 전환용) |
| **Color Button** | 리모컨의 Red/Green/Yellow/Blue 버튼 (사용자 정의 기능) |
| **Playback Control** | 재생 버튼 (Play/Pause, FastForward, Rewind 등) |
| **Back Button** | 리모컨의 뒤로가기 버튼 (Backspace 또는 webOS Back 키) |
| **Menu/Settings Button** | 리모컨의 설정/메뉴 버튼 |
| **Debounce** | 중복 입력 방지를 위한 짧은 대기 시간 (0.5초) |
| **Spotlight Container** | Enact Spotlight 시스템의 포커스 그룹 단위 |
| **KeyboardHandler** | 리모컨 키 이벤트를 처리하는 중앙 서비스 모듈 |

---

## 6. 범위 외 (Out of Scope)

### 이번 버전에서 구현하지 않는 것

- **음성 인식 단축키**: webOS 음성 인식 API는 별도 기능으로 분리 (F-16 후보)
- **사용자 정의 키 매핑**: 설정 화면에서 키 매핑을 변경하는 기능 (추후 고려)
- **키보드 동작 튜토리얼**: 처음 실행 시 단축키를 안내하는 오버레이 (F-17 후보)
- **제스처 인식**: 리모컨 모션 센서 활용은 제외 (webOS 4.0에서 미지원)
- **북마크 추가 단축키 (Yellow 버튼)**: features.md에 명시되었으나 Yellow는 이미 다운로드 패널로 사용 중이므로 제외

---

## 7. 현재 구현 상태 분석

### useRemoteControl.js 현황
```javascript
// ✅ 이미 구현됨
- Back 키 (8, 461) → 브라우저 뒤로가기 (WebView 포커스 시)
- Back 키 (8, 461) → Spotlight 포커스 이탈 (NavigationBar 포커스 시)
- Yellow 버튼 (405, 406) → 다운로드 패널 열기

// ❌ 추가 필요
- Channel Up/Down (427, 428) → 탭 전환
- Red 버튼 (403, 404) → 북마크 패널 열기
- Green 버튼 (405, 406) → 히스토리 패널 열기
- Blue 버튼 (407, 408) → 새 탭 생성
- 숫자 키 (49~53) → 직접 탭 선택
- Menu 버튼 (457, 18) → 설정 패널 열기
- Play/Pause 버튼 (415, 19) → 자동 스크롤 (선택적)
- FastForward/Rewind 버튼 (417, 412) → 페이지 끝/위로 스크롤 (선택적)
```

### NavigationBar.js 현황
- NavigationBar는 onClick 핸들러만 구현 (버튼 클릭)
- 리모컨 단축키 로직은 없음 (useRemoteControl Hook이 담당)

### BrowserView.js 현황
- useRemoteControl Hook을 이미 사용 중
- handleBookmarkClick, handleNewTab 등 필요한 핸들러 모두 구현됨
- 단축키 추가 시 useRemoteControl 옵션에 콜백만 추가하면 됨

---

## 8. 수용 기준 (Acceptance Criteria)

### AC-1: 채널 버튼 탭 전환
- [ ] Channel Up 버튼으로 이전 탭으로 전환 가능
- [ ] Channel Down 버튼으로 다음 탭으로 전환 가능
- [ ] 탭 전환 시 WebView에 자동 포커스
- [ ] 탭이 1개만 있을 때 무시
- [ ] 순환 전환 동작 (첫 탭 ↔ 마지막 탭)

### AC-2: 컬러 버튼 기능 접근
- [ ] Red 버튼으로 북마크 패널 열기 가능
- [ ] Green 버튼으로 히스토리 패널 열기 가능
- [ ] Blue 버튼으로 새 탭 생성 가능
- [ ] Yellow 버튼으로 다운로드 패널 열기 가능 (이미 구현됨)
- [ ] 패널이 이미 열려있을 때 중복 열기 무시
- [ ] 새 탭 생성 시 최대 탭 수 제한 체크

### AC-3: 숫자 버튼 직접 탭 선택
- [ ] 1~5 버튼으로 해당 탭에 즉시 이동 가능
- [ ] 존재하지 않는 탭 번호 입력 시 무시
- [ ] URLBar 키보드 열려있을 때 동작 안 함

### AC-4: 설정 버튼 접근
- [ ] Menu/Settings 버튼으로 설정 패널 열기 가능
- [ ] 패널 열기 시 자동 포커스

### AC-5: 스크롤 제어 (선택적)
- [ ] Play/Pause 버튼으로 자동 스크롤 시작/멈춤
- [ ] FastForward 버튼으로 페이지 끝으로 이동
- [ ] Rewind 버튼으로 페이지 맨 위로 이동
- [ ] WebView 포커스 시에만 동작

### AC-6: 반응 속도 및 키 충돌 방지
- [ ] 리모컨 키 입력 후 0.3초 이내 반응
- [ ] 0.5초 이내 동일 키 재입력 무시 (디바운스)
- [ ] URLBar 키보드 열려있을 때 단축키 무시
- [ ] 패널 내부에서는 패널의 Spotlight 네비게이션 우선

### AC-7: 로깅 및 디버깅
- [ ] 리모컨 키 입력 시 logger.debug로 keyCode 기록
- [ ] 키 매핑 실패 시 경고 로그 출력

### AC-8: 기존 기능과의 호환성
- [ ] Back 키 기존 동작 유지 (브라우저 뒤로가기/포커스 이탈)
- [ ] Spotlight 시스템과 충돌 없음
- [ ] NavigationBar 버튼 클릭 동작 정상 작동

---

## 9. 테스트 시나리오

### 시나리오 1: 채널 버튼으로 탭 전환
1. 탭 3개 생성 (Tab1, Tab2, Tab3)
2. Tab1 활성화 상태에서 Channel Down 버튼 누름
3. **예상**: Tab2로 전환, WebView 포커스
4. Channel Down 한 번 더 누름
5. **예상**: Tab3로 전환
6. Channel Down 한 번 더 누름
7. **예상**: Tab1로 순환 전환

### 시나리오 2: 컬러 버튼으로 패널 열기
1. Red 버튼 누름
2. **예상**: 북마크 패널 열림
3. Back 키로 패널 닫기
4. Green 버튼 누름
5. **예상**: 히스토리 패널 열림
6. Back 키로 패널 닫기
7. Blue 버튼 누름
8. **예상**: 새 탭 생성, 활성화

### 시나리오 3: 숫자 버튼으로 탭 선택
1. 탭 4개 생성
2. 숫자 3 버튼 누름
3. **예상**: 세 번째 탭 활성화
4. 숫자 5 버튼 누름
5. **예상**: 네 번째 탭 활성화 (탭 5는 없으므로 4로 유지)
6. 숫자 1 버튼 누름
7. **예상**: 첫 번째 탭 활성화

### 시나리오 4: URLBar 키보드 열릴 때 충돌 방지
1. URLBar 클릭, 가상 키보드 열림
2. 숫자 3 버튼 누름
3. **예상**: URLBar에 "3" 입력됨, 탭 전환 안 됨
4. Back 키로 키보드 닫기
5. 숫자 3 버튼 누름
6. **예상**: 세 번째 탭으로 전환

### 시나리오 5: 최대 탭 수 제한
1. 탭 5개 생성 (최대 개수)
2. Blue 버튼 누름
3. **예상**: 새 탭 생성 안 됨, 경고 로그 출력

### 시나리오 6: 스크롤 제어
1. 긴 웹 페이지 로드 (예: Wikipedia 문서)
2. Play 버튼 누름
3. **예상**: 자동 스크롤 시작 (초당 100px)
4. Pause 버튼 누름
5. **예상**: 스크롤 멈춤
6. FastForward 버튼 누름
7. **예상**: 페이지 끝으로 이동
8. Rewind 버튼 누름
9. **예상**: 페이지 맨 위로 이동

---

## 10. 변경 이력

| 날짜 | 변경 내용 | 작성자 |
|------|-----------|--------|
| 2026-02-14 | 초안 작성 | product-manager |
