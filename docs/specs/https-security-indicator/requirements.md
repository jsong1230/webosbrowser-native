# F-14: HTTPS 보안 표시 — 요구사항 분석서

## 1. 개요

- **기능명**: HTTPS 보안 표시
- **기능 ID**: F-14
- **목적**: 사용자가 접속 중인 웹사이트의 보안 상태를 시각적으로 확인하고, 안전하지 않은 사이트 접속 시 경고를 받을 수 있도록 한다.
- **대상 사용자**: 가정용 프로젝터로 웹 브라우징을 하는 모든 사용자
- **요청 배경**:
  - webOS 프로젝터는 개인 정보 입력이 가능한 브라우징 환경이므로, 보안 연결 여부를 명확히 표시하여 사용자의 보안 인식을 강화해야 한다.
  - 특히 리모컨 기반 UX에서는 URL을 자세히 읽지 않고 조작하는 경우가 많아, 보안 상태를 즉시 식별할 수 있는 시각적 UI가 필요하다.
  - 피싱 사이트나 안전하지 않은 HTTP 연결에서 개인 정보를 입력하는 것을 방지한다.

---

## 2. 기능 요구사항 (Functional Requirements)

### FR-1: HTTPS 보안 아이콘 표시
- **설명**: URLBar에 현재 페이지의 보안 상태를 나타내는 아이콘을 표시한다.
- **유저 스토리**: As a 사용자, I want URL 입력창 옆에 자물쇠 아이콘을 보고, so that 내가 접속 중인 사이트가 보안 연결인지 즉시 알 수 있다.
- **우선순위**: Must
- **세부 요구사항**:
  - **HTTPS (Secure)**: 녹색 자물쇠 아이콘 (🔒) + "보안 연결" 툴팁
  - **HTTP (Insecure)**: 경고 아이콘 (⚠️) + "안전하지 않음" 툴팁
  - **localhost / file://**: 정보 아이콘 (ℹ️) + "로컬" 툴팁
  - **Unknown**: 아이콘 없음 (초기 상태, about:blank 등)
- **동작 방식**:
  - WebView의 `onNavigationChange` 콜백이 URL 변경을 감지하면, URLBar가 URL 프로토콜을 체크하여 아이콘을 업데이트한다.
  - 아이콘은 URLBar 컴포넌트 좌측에 Input 필드와 함께 표시된다.
  - 리모컨 포커스 시 아이콘에 툴팁이 표시된다 (Moonstone Tooltip 사용).

### FR-2: 비보안 사이트 접속 경고 다이얼로그
- **설명**: 사용자가 HTTP 사이트로 처음 이동할 때 경고 다이얼로그를 표시한다.
- **유저 스토리**: As a 사용자, I want 안전하지 않은 사이트에 접속할 때 경고를 받아서, so that 개인 정보를 입력하기 전에 보안 위험을 인지할 수 있다.
- **우선순위**: Must
- **세부 요구사항**:
  - **경고 조건**: URL이 `http://`로 시작하는 사이트로 이동할 때
  - **예외**: `localhost`, `127.0.0.1`, `192.168.*.*` 등 로컬 IP는 경고하지 않음
  - **다이얼로그 내용**:
    - 제목: "안전하지 않은 사이트"
    - 메시지: "이 사이트는 보안 연결을 사용하지 않습니다. 개인 정보(비밀번호, 신용카드 번호 등)를 입력하지 마세요."
    - 버튼:
      - "계속 진행" (기본 포커스): 경고를 무시하고 사이트 로드
      - "돌아가기": 이전 페이지로 돌아감 (history.back)
  - **다시 보지 않기 옵션** (선택적):
    - 체크박스: "오늘 이 사이트에 대해 다시 표시하지 않기"
    - 체크 시, 세션 종료까지 해당 도메인에 대한 경고 숨김 (메모리 저장)
- **동작 방식**:
  - WebView의 `onNavigationChange` 콜백이 URL 변경을 감지하면, URL 프로토콜을 체크한다.
  - HTTP 사이트이고, 경고를 무시한 도메인 목록에 없으면 다이얼로그를 표시한다.
  - 다이얼로그 표시 중에는 WebView 로딩을 일시 중지하고, "계속 진행" 선택 시 로딩을 재개한다.

### FR-3: URL 프로토콜 자동 감지 및 분류
- **설명**: 웹 페이지 URL을 분석하여 보안 등급을 자동으로 분류한다.
- **유저 스토리**: As a 개발자, I want URL 프로토콜을 자동으로 감지하여, so that 보안 아이콘과 경고를 일관되게 표시할 수 있다.
- **우선순위**: Must
- **세부 요구사항**:
  - **보안 등급 분류**:
    - `secure`: `https://`로 시작
    - `insecure`: `http://`로 시작 (localhost 제외)
    - `local`: `http://localhost`, `http://127.0.0.1`, `http://192.168.*`, `file://`
    - `unknown`: 위의 어느 것에도 해당하지 않음 (`about:blank`, 초기 상태 등)
  - **분류 로직**: `utils/securityClassifier.js` 유틸리티 함수로 구현
  - **예외 처리**:
    - `null`, `undefined`, 빈 문자열은 `unknown`으로 분류
    - URL 파싱 실패 시 `unknown`으로 분류

### FR-4: 보안 상태 실시간 업데이트
- **설명**: 페이지 이동 시 보안 아이콘이 실시간으로 업데이트된다.
- **유저 스토리**: As a 사용자, I want 페이지를 이동할 때마다 보안 아이콘이 즉시 바뀌어서, so that 현재 페이지의 보안 상태를 항상 정확히 알 수 있다.
- **우선순위**: Must
- **세부 요구사항**:
  - WebView의 `onNavigationChange` 콜백을 통해 URL 변경을 감지한다.
  - URL 변경 시 500ms 이내에 보안 아이콘이 업데이트되어야 한다.
  - 페이지 로딩 중에도 보안 아이콘은 즉시 표시된다 (로딩 완료 대기 X).

### FR-5: 보안 상태 정보 다이얼로그 (선택적)
- **설명**: 보안 아이콘 클릭 시 상세 보안 정보를 표시하는 다이얼로그를 제공한다.
- **유저 스토리**: As a 사용자, I want 자물쇠 아이콘을 클릭하여, so that 현재 사이트의 인증서 정보나 보안 수준을 자세히 확인할 수 있다.
- **우선순위**: Could (M3 범위 외, 향후 구현)
- **세부 요구사항**:
  - **다이얼로그 내용**:
    - 보안 수준: "보안 연결" / "안전하지 않음" / "로컬 연결"
    - URL: 전체 URL 표시
    - 프로토콜: HTTPS / HTTP / file://
    - 인증서 정보: (webOS CORS 제약으로 인증서 정보 접근 불가 → "정보 없음" 표시)
  - **제약사항**: webOS iframe은 인증서 정보에 접근할 수 없으므로, 프로토콜 기반 보안 수준만 표시한다.

---

## 3. 비기능 요구사항 (Non-Functional Requirements)

### NFR-1: 성능
- **반응 속도**: URL 변경 감지 후 500ms 이내에 보안 아이콘 업데이트
- **UI 렌더링**: 아이콘 표시로 인한 URLBar 레이아웃 시프트 없음 (아이콘 영역 고정 너비 확보)
- **메모리**: 경고 무시 도메인 목록을 메모리에 저장 (세션당 최대 100개 제한)

### NFR-2: 사용성
- **일관성**: 보안 아이콘은 항상 URLBar 좌측 고정 위치에 표시
- **가독성**: 프로젝터 대화면에서 아이콘이 명확히 식별 가능 (최소 32x32px 크기)
- **접근성**: 리모컨 포커스로 아이콘에 접근 가능, 툴팁으로 보안 상태 설명 제공

### NFR-3: 보안
- **보안 정책**: HTTP 사이트 경고는 사용자가 명시적으로 무시하지 않는 한 항상 표시
- **개인 정보 보호**: 경고 무시 도메인 목록은 세션 메모리에만 저장 (로컬 저장소 저장 X, 재시작 시 초기화)

### NFR-4: 확장성
- **보안 등급 추가**: `securityClassifier.js`에 새로운 보안 등급 추가 가능 (예: `mixed-content`, `certificate-error` 등)
- **아이콘 테마**: 라이트/다크 테마에 따라 아이콘 색상 자동 조정 (CSS 변수 사용)

---

## 4. 제약조건

### TC-1: webOS CORS 제약
- **설명**: webOS iframe은 Same-Origin Policy로 인해 외부 도메인의 인증서 정보, Document 객체에 접근할 수 없다.
- **영향**:
  - SSL 인증서 정보 표시 불가 (인증 기관, 유효 기간 등)
  - Mixed Content 감지 불가 (HTTPS 페이지 내 HTTP 리소스 로드)
  - Strict-Transport-Security (HSTS) 헤더 확인 불가
- **대응 방안**: URL 프로토콜 기반 보안 수준 분류로 제한

### TC-2: iframe 네비게이션 감지 제약
- **설명**: WebView는 500ms 폴링으로 URL 변경을 감지하므로, 빠른 리다이렉트 시 중간 URL을 놓칠 수 있다.
- **영향**: HTTP → HTTPS 자동 리다이렉트 시 경고 다이얼로그가 잠깐 표시될 수 있음
- **대응 방안**:
  - 경고 다이얼로그는 로딩 완료 전까지 표시 지연 (500ms 디바운스)
  - HTTPS로 리다이렉트되면 경고를 자동으로 닫음

### TC-3: 리모컨 UX 제약
- **설명**: 리모컨 기반 UX에서는 마우스 호버, 우클릭 메뉴 등을 사용할 수 없다.
- **영향**: 보안 아이콘 호버 시 상세 정보 표시 불가
- **대응 방안**: 리모컨 포커스 시 툴팁으로 간략한 정보 표시, 상세 정보는 다이얼로그로 제공 (선택 키 누름)

### TC-4: HSTS 지원 불가
- **설명**: webOS iframe은 HSTS 정책을 강제하지 않으므로, HTTP 요청을 자동으로 HTTPS로 업그레이드하지 않는다.
- **영향**: HSTS가 적용된 사이트도 사용자가 `http://` URL을 입력하면 HTTP로 접속 시도
- **대응 방안**: URL 입력 시 자동으로 `https://` 프로토콜을 우선 적용 (urlValidator.js에서 처리)

---

## 5. 용어 정의

| 용어 | 정의 |
|------|------|
| **HTTPS** | HTTP over SSL/TLS. 암호화된 보안 연결을 사용하는 프로토콜 |
| **SSL/TLS** | Secure Sockets Layer / Transport Layer Security. 웹 통신을 암호화하는 프로토콜 |
| **Mixed Content** | HTTPS 페이지 내에서 HTTP 리소스를 로드하는 보안 취약점 |
| **CORS** | Cross-Origin Resource Sharing. 다른 도메인의 리소스 접근을 제한하는 브라우저 정책 |
| **HSTS** | HTTP Strict Transport Security. 브라우저가 HTTP를 HTTPS로 자동 업그레이드하도록 강제하는 정책 |
| **Same-Origin Policy** | 같은 출처(도메인, 프로토콜, 포트)의 리소스만 접근할 수 있도록 제한하는 보안 정책 |
| **보안 등급 (Security Level)** | URL 프로토콜 기반으로 분류한 보안 상태: `secure`, `insecure`, `local`, `unknown` |

---

## 6. 범위 외 (Out of Scope)

### 6.1. M3 범위 외 (향후 구현 고려)
- **FR-5**: 보안 아이콘 클릭 시 상세 정보 다이얼로그
  - **이유**: M3 핵심 기능이 아니며, CORS 제약으로 표시할 수 있는 정보가 제한적

### 6.2. 기술적 제약으로 구현 불가
- **SSL 인증서 정보 표시**: 인증 기관, 유효 기간, 암호화 수준 등
  - **이유**: webOS iframe은 CORS로 인해 인증서 정보에 접근 불가
- **Mixed Content 감지 및 경고**
  - **이유**: webOS iframe은 페이지 내부 리소스 로드 상태를 감지할 수 없음
- **HSTS 자동 업그레이드**
  - **이유**: webOS iframe은 HSTS 헤더를 강제하지 않음
- **인증서 오류 감지** (만료, 자체 서명, 도메인 불일치 등)
  - **이유**: webOS iframe의 onError 이벤트는 인증서 오류를 구분하지 않음

### 6.3. 사용자 설정 제외
- **보안 경고 완전 비활성화 옵션**
  - **이유**: 사용자 보안을 위해 경고는 항상 표시되어야 함 (무시 옵션은 세션 단위로만 제공)

---

## 7. 수용 기준 (Acceptance Criteria)

### AC-1: HTTPS 사이트 아이콘 표시
- **Given**: 사용자가 `https://www.google.com`에 접속
- **When**: 페이지가 로드됨
- **Then**:
  - URLBar 좌측에 녹색 자물쇠 아이콘 (🔒) 표시
  - 아이콘에 포커스 시 "보안 연결" 툴팁 표시

### AC-2: HTTP 사이트 경고 다이얼로그
- **Given**: 사용자가 `http://example.com`에 접속
- **When**: URL이 입력되거나 링크를 클릭
- **Then**:
  - 경고 다이얼로그 표시: "안전하지 않은 사이트"
  - "계속 진행" 버튼 선택 시 페이지 로드, URLBar에 경고 아이콘 (⚠️) 표시
  - "돌아가기" 버튼 선택 시 이전 페이지로 돌아감

### AC-3: localhost 예외 처리
- **Given**: 사용자가 `http://localhost:3000`에 접속
- **When**: 페이지가 로드됨
- **Then**:
  - 경고 다이얼로그 표시되지 않음
  - URLBar 좌측에 정보 아이콘 (ℹ️) 표시
  - 아이콘에 포커스 시 "로컬 연결" 툴팁 표시

### AC-4: 페이지 이동 시 아이콘 업데이트
- **Given**: 사용자가 `https://www.google.com`에서 `http://example.com`으로 이동
- **When**: 페이지 이동이 감지됨 (onNavigationChange)
- **Then**:
  - 500ms 이내에 보안 아이콘이 자물쇠 (🔒) → 경고 (⚠️)로 변경
  - 경고 다이얼로그 표시 (처음 접속 시)

### AC-5: 경고 무시 옵션 (세션 단위)
- **Given**: 사용자가 `http://example.com`에 처음 접속하여 경고 다이얼로그 표시
- **When**: "오늘 이 사이트에 대해 다시 표시하지 않기" 체크 후 "계속 진행" 선택
- **Then**:
  - 세션 동안 `http://example.com`에 재접속 시 경고 다이얼로그 표시되지 않음
  - 앱 재시작 후에는 경고 다시 표시됨 (메모리 초기화)

### AC-6: URL 프로토콜 자동 분류
- **Given**: securityClassifier.js 유틸리티 함수 호출
- **When**: 다양한 URL 입력
- **Then**:
  - `https://example.com` → `secure`
  - `http://example.com` → `insecure`
  - `http://localhost:3000` → `local`
  - `file:///path/to/file.html` → `local`
  - `about:blank` → `unknown`
  - `null` → `unknown`

### AC-7: 아이콘 툴팁 표시
- **Given**: 사용자가 URLBar의 보안 아이콘에 포커스
- **When**: 리모컨으로 포커스 이동
- **Then**:
  - HTTPS 사이트: "보안 연결" 툴팁 표시
  - HTTP 사이트: "안전하지 않음" 툴팁 표시
  - 로컬: "로컬 연결" 툴팁 표시

---

## 8. 테스트 시나리오

### TS-1: HTTPS 사이트 보안 아이콘 표시
1. 앱 실행
2. URLBar에 `https://www.google.com` 입력 후 확인
3. 페이지 로드 완료
4. **검증**: URLBar 좌측에 녹색 자물쇠 아이콘 표시
5. 아이콘에 포커스 이동
6. **검증**: "보안 연결" 툴팁 표시

### TS-2: HTTP 사이트 경고 다이얼로그
1. 앱 실행
2. URLBar에 `http://example.com` 입력 후 확인
3. **검증**: 경고 다이얼로그 표시 ("안전하지 않은 사이트")
4. "계속 진행" 버튼 선택
5. 페이지 로드 완료
6. **검증**: URLBar 좌측에 경고 아이콘 (⚠️) 표시

### TS-3: localhost 예외 처리
1. 앱 실행
2. URLBar에 `http://localhost:3000` 입력 후 확인
3. **검증**: 경고 다이얼로그 표시되지 않음
4. 페이지 로드 완료
5. **검증**: URLBar 좌측에 정보 아이콘 (ℹ️) 표시

### TS-4: HTTPS → HTTP 이동 시 경고
1. 앱 실행
2. URLBar에 `https://www.google.com` 입력 후 확인
3. 페이지 로드 완료
4. URLBar에 `http://example.com` 입력 후 확인
5. **검증**: 경고 다이얼로그 표시
6. "계속 진행" 선택
7. **검증**: 보안 아이콘이 자물쇠 → 경고로 변경

### TS-5: 페이지 내 링크 클릭 시 보안 아이콘 업데이트
1. 앱 실행
2. `https://www.google.com` 접속
3. 페이지 내에서 `http://example.com` 링크 클릭 (CORS 제약으로 시뮬레이션 필요)
4. **검증**: 500ms 이내에 보안 아이콘이 자물쇠 → 경고로 변경
5. **검증**: 경고 다이얼로그 표시

### TS-6: 경고 무시 옵션 (세션 단위)
1. 앱 실행
2. `http://example.com` 접속
3. 경고 다이얼로그에서 "오늘 이 사이트에 대해 다시 표시하지 않기" 체크
4. "계속 진행" 선택
5. 다른 페이지로 이동 후 다시 `http://example.com` 접속
6. **검증**: 경고 다이얼로그 표시되지 않음
7. 앱 재시작
8. `http://example.com` 접속
9. **검증**: 경고 다이얼로그 다시 표시됨

### TS-7: HTTP → HTTPS 자동 리다이렉트 시 경고 숨김
1. 앱 실행
2. `http://github.com` 접속 (실제로는 `https://github.com`으로 자동 리다이렉트됨)
3. **검증**: 경고 다이얼로그가 표시되더라도 500ms 내에 자동으로 닫힘
4. 최종 페이지 로드 완료
5. **검증**: URLBar에 `https://github.com` 표시, 녹색 자물쇠 아이콘 표시

### TS-8: URL 분류 유틸리티 단위 테스트
1. securityClassifier.js 단위 테스트 실행
2. **검증**: 다음 URL 분류 결과 확인
   - `https://example.com` → `secure`
   - `http://example.com` → `insecure`
   - `http://localhost` → `local`
   - `http://127.0.0.1:8080` → `local`
   - `http://192.168.1.1` → `local`
   - `file:///path/to/file.html` → `local`
   - `about:blank` → `unknown`
   - `null` → `unknown`

---

## 9. 우선순위 및 구현 순서

### Phase 1: 보안 등급 분류 (High Priority)
- **FR-3**: URL 프로토콜 자동 감지 및 분류
- **산출물**: `utils/securityClassifier.js`

### Phase 2: 보안 아이콘 표시 (High Priority)
- **FR-1**: HTTPS 보안 아이콘 표시
- **FR-4**: 보안 상태 실시간 업데이트
- **산출물**: `components/SecurityIndicator/SecurityIndicator.js`, URLBar 컴포넌트 확장

### Phase 3: 경고 다이얼로그 (High Priority)
- **FR-2**: 비보안 사이트 접속 경고 다이얼로그
- **산출물**: `components/SecurityWarningDialog/SecurityWarningDialog.js`

### Phase 4: 테스트 및 검증 (Must)
- **AC-1 ~ AC-7**: 수용 기준 테스트
- **TS-1 ~ TS-8**: 테스트 시나리오 실행

### Phase 5: 상세 정보 다이얼로그 (Low Priority, 선택적)
- **FR-5**: 보안 상태 정보 다이얼로그 (M3 범위 외)

---

## 10. 의존성

### 선행 기능
- **F-02 (웹뷰 통합)**: WebView 컴포넌트의 `onNavigationChange` 콜백 필수
- **F-03 (URL 입력 UI)**: URLBar 컴포넌트 확장 필요

### 연동 컴포넌트
- **WebView**: URL 변경 감지 (`onNavigationChange`)
- **URLBar**: 보안 아이콘 표시 영역 추가
- **App.js**: 경고 다이얼로그 상태 관리 (BrowserView 레벨에서 관리 가능)

### 외부 라이브러리
- **Enact Moonstone**: `Icon`, `Tooltip`, `Dialog` 컴포넌트 사용
- **없음**: 외부 SSL 검증 라이브러리 불필요 (URL 프로토콜 기반 분류)

---

## 11. 리스크 및 대응 방안

| 리스크 | 영향도 | 확률 | 대응 방안 |
|--------|--------|------|-----------|
| CORS 제약으로 인증서 정보 접근 불가 | High | 확정 | URL 프로토콜 기반 보안 수준 분류로 제한 |
| 빠른 리다이렉트 시 중간 URL 놓침 | Medium | Medium | 경고 다이얼로그 500ms 디바운스, HTTPS 리다이렉트 시 자동 닫기 |
| 사용자가 경고를 무시하고 HTTP 사이트 사용 | Low | High | 세션 단위 무시 옵션 제공, 재시작 시 초기화 |
| Mixed Content 감지 불가 | Medium | 확정 | 범위 외로 명시, 프로토콜 기반 보안 수준만 표시 |
| 리모컨 UX에서 보안 정보 접근 어려움 | Low | Medium | 툴팁으로 간략한 정보 제공, 상세 정보는 다이얼로그로 제공 (선택적) |

---

## 10. 변경 이력

| 날짜 | 버전 | 변경 내용 | 작성자 |
|------|------|-----------|--------|
| 2026-02-14 | 1.0 | 초기 작성 | product-manager |

---

## 11. 검토 및 승인

| 역할 | 이름 | 승인 여부 | 날짜 |
|------|------|-----------|------|
| Product Manager | - | 승인 | 2026-02-14 |
| Architect | - | 대기 | - |
| Frontend Developer | - | 대기 | - |
