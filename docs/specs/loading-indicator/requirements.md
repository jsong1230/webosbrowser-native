# 로딩 인디케이터 — 요구사항 분석서

## 1. 개요

### 기능명
F-05: 로딩 인디케이터 (Loading Indicator)

### 목적
웹 페이지 로딩 중 시각적 피드백(프로그레스바, 스피너)을 제공하여 사용자가 현재 상태를 명확히 인지하고, 로딩 완료까지 기다릴 수 있도록 합니다.

### 대상 사용자
- webOS Browser의 모든 사용자 (웹 페이지 탐색 시)
- 특히 네트워크 속도가 느린 환경의 사용자
- 대화면 프로젝터에서 원거리 시청하는 사용자

### 요청 배경
- **사용자 경험**: 웹 페이지 로딩 시간이 길어질 경우 사용자는 앱이 멈춘 것으로 오해할 수 있음
- **PRD 요구사항**: 페이지 로딩 5초 이내 목표 (일반 웹사이트 기준)이지만, 네트워크 지연 시 더 길어질 수 있음
- **플랫폼 제약**: webOS 프로젝터 환경에서는 무선 네트워크 사용으로 로딩 시간 변동성이 큼
- **시각적 피드백 필요성**: 리모컨 조작 환경에서는 진행 상태 표시가 더욱 중요 (마우스 커서가 없어 시각적 단서 부족)

## 2. 기능 요구사항 (Functional Requirements)

### FR-1: 프로그레스바 표시
- **설명**: 웹 페이지 로딩 중 화면 상단에 수평 프로그레스바를 표시하여 로딩 진행 상태를 시각적으로 전달합니다.
- **유저 스토리**: As a 사용자, I want 페이지 로딩 중 진행 상태를 보고 싶다, so that 앱이 정상 동작 중임을 확인하고 기다릴 수 있다.
- **우선순위**: Must
- **상세 기능**:
  - 로딩 시작 시 프로그레스바가 0%에서 시작
  - 로딩 진행에 따라 프로그레스바가 증가 (0% → 100%)
  - 로딩 완료 시 100%에 도달 후 페이드아웃
  - 로딩 실패 시 프로그레스바 즉시 사라짐
- **기술적 제약**:
  - iframe 기반 WebView는 실제 로딩 진행률(loadprogress 이벤트) 제공 불가
  - 가상 진행률 애니메이션으로 구현 (시간 기반 진행률 시뮬레이션)

### FR-2: 로딩 스피너 표시
- **설명**: 프로그레스바와 함께 화면 중앙에 로딩 스피너(회전 애니메이션)를 표시하여 로딩 중임을 강조합니다.
- **유저 스토리**: As a 사용자, I want 페이지가 로딩 중일 때 명확한 시각적 표시를 보고 싶다, so that 앱이 응답하지 않는 것으로 착각하지 않는다.
- **우선순위**: Must
- **상세 기능**:
  - 로딩 시작 시 화면 중앙에 회전하는 스피너 표시
  - 스피너 아래에 "페이지 로딩 중..." 텍스트 표시
  - 로딩 완료 또는 실패 시 스피너 즉시 사라짐
  - 스피너는 WebView 위에 오버레이로 표시 (z-index 높음)

### FR-3: 로딩 상태 텍스트 표시
- **설명**: 현재 로딩 중인 URL 또는 상태 메시지를 텍스트로 표시하여 사용자에게 추가 정보를 제공합니다.
- **유저 스토리**: As a 사용자, I want 어떤 페이지를 로딩 중인지 알고 싶다, so that 올바른 URL을 입력했는지 확인할 수 있다.
- **우선순위**: Should
- **상세 기능**:
  - 로딩 중인 URL을 짧게 표시 (예: "www.google.com 로딩 중...")
  - 긴 URL은 말줄임(...) 처리 (최대 50자)
  - 스피너 아래 또는 프로그레스바 옆에 배치
  - 로딩 완료/실패 시 사라짐

### FR-4: 로딩 타임아웃 표시
- **설명**: 로딩 시간이 30초를 초과할 경우 "로딩이 오래 걸리고 있습니다" 메시지를 표시합니다.
- **유저 스토리**: As a 사용자, I want 로딩이 비정상적으로 오래 걸릴 때 알림을 받고 싶다, so that 취소 또는 재시도 여부를 결정할 수 있다.
- **우선순위**: Should
- **상세 기능**:
  - 로딩 시작 후 30초 경과 시 경고 메시지 표시
  - "로딩이 오래 걸리고 있습니다. 네트워크를 확인해주세요." 텍스트
  - 취소 버튼 제공 (리모컨 Back 버튼 또는 화면 버튼)
  - 타임아웃 발생 시 WebView의 onLoadError 이벤트와 연동

### FR-5: 가상 진행률 애니메이션
- **설명**: 실제 로딩 진행률을 알 수 없으므로, 시간 기반 가상 진행률을 계산하여 프로그레스바를 부드럽게 증가시킵니다.
- **유저 스토리**: As a 사용자, I want 프로그레스바가 자연스럽게 진행되는 것을 보고 싶다, so that 로딩이 진행 중임을 체감할 수 있다.
- **우선순위**: Must
- **상세 기능**:
  - **0~3초**: 0% → 60% 빠르게 증가 (체감 속도 개선)
  - **3~10초**: 60% → 90% 느리게 증가 (실제 로딩 대기)
  - **10초~완료**: 90% → 95% 매우 느리게 증가 (무한 대기 방지)
  - **로딩 완료 시**: 95% → 100% 즉시 이동 후 페이드아웃
  - **가속도 곡선**: Ease-out 애니메이션 적용 (초반 빠르고 후반 느림)
- **기술적 구현**:
  - setInterval 또는 requestAnimationFrame으로 진행률 업데이트
  - 로딩 완료 이벤트 수신 시 애니메이션 중단 후 100% 이동

### FR-6: 에러 상태 시각적 피드백
- **설명**: 페이지 로딩 실패 시 프로그레스바를 빨간색으로 변경하고 에러 아이콘을 표시합니다.
- **유저 스토리**: As a 사용자, I want 로딩 실패 시 명확한 시각적 피드백을 받고 싶다, so that 문제가 발생했음을 즉시 인지할 수 있다.
- **우선순위**: Should
- **상세 기능**:
  - 로딩 실패 시 프로그레스바 색상을 녹색 → 빨간색으로 변경
  - 스피너를 에러 아이콘(⚠️)으로 교체
  - 1초간 표시 후 페이드아웃
  - F-10(에러 처리)의 ErrorPage로 전환

### FR-7: Enact Moonstone UI 통합
- **설명**: Enact Moonstone의 ProgressBar, Spinner 컴포넌트를 사용하여 플랫폼 일관성을 유지합니다.
- **우선순위**: Must
- **상세 기능**:
  - Enact의 `@enact/moonstone/ProgressBar` 사용 (가능 시)
  - Enact의 `@enact/moonstone/Spinner` 사용
  - Moonstone 테마(다크/라이트)에 따라 스타일 자동 적용
  - 커스텀 스타일 최소화 (Enact 기본 스타일 우선)

## 3. 비기능 요구사항 (Non-Functional Requirements)

### NFR-1: 성능
- **애니메이션 프레임레이트**: 프로그레스바 애니메이션은 최소 30fps 유지 (부드러운 시각 효과)
- **메모리 사용량**: LoadingBar 컴포넌트는 5MB 이하 메모리 사용
- **CPU 사용률**: 로딩 애니메이션이 WebView 렌더링을 방해하지 않도록 CPU 사용률 10% 이하 유지
- **초기화 시간**: LoadingBar 컴포넌트 마운트 시간 50ms 이하

### NFR-2: 사용성 (UX)
- **가독성**: 프로그레스바는 화면 상단 전체 너비를 차지하여 원거리에서도 보임
- **스피너 크기**: 스피너는 최소 80px 이상 크기로 대화면에서도 명확히 보임
- **텍스트 크기**: 로딩 상태 텍스트는 최소 24px 폰트 (PRD 가독성 기준)
- **대비**: 스피너와 배경 간 명도 대비 4.5:1 이상 (WCAG AA 기준)
- **페이드아웃 시간**: 로딩 완료 후 페이드아웃은 0.5초 이내 (빠른 전환)

### NFR-3: 접근성
- **색맹 대응**: 프로그레스바는 색상뿐만 아니라 애니메이션으로도 진행 상태 전달
- **모션 저감**: 모션 감도가 높은 사용자를 위해 애니메이션 비활성화 옵션 제공 (향후 F-11 설정에서 구현 고려)

### NFR-4: 반응성
- **로딩 시작 지연**: 웹뷰 로딩 시작 후 100ms 이내 프로그레스바 표시 시작
- **로딩 완료 지연**: 웹뷰 로딩 완료 후 200ms 이내 프로그레스바 100% 도달 및 페이드아웃

### NFR-5: 호환성
- **webOS 버전**: webOS 4.x 이상에서 동일한 애니메이션 동작 보장
- **브라우저 호환**: Chromium 53+ (webOS 4.x 엔진) 기반 CSS 애니메이션 사용
- **Enact 버전**: Enact 4.x의 Moonstone UI 컴포넌트 호환

## 4. 제약조건

### 기술적 제약
1. **iframe 이벤트 제약**: HTML5 iframe은 실제 로딩 진행률(0~100%)을 제공하지 않음
   - 대응: 가상 진행률 알고리즘 구현 (시간 기반)
2. **CORS 제약**: iframe 내부 DOM에 접근 불가하여 로딩 상태 세부 정보 추출 불가
   - 대응: WebView의 onLoadStart, onLoadEnd 이벤트만 활용
3. **webOS 성능 제약**: 프로젝터 하드웨어 성능이 제한적이므로 CSS 애니메이션 복잡도 제한
   - 대응: transform, opacity만 사용 (reflow 유발 속성 회피)

### 디자인 제약
1. **Moonstone UI 스타일**: Enact Moonstone 테마를 따라야 하므로 커스텀 스타일 최소화
2. **대화면 가독성**: 최소 폰트 크기 24px, 프로그레스바 높이 최소 8px

### 기능 의존성
1. **F-02 의존**: WebView의 onLoadStart, onLoadEnd, onLoadError 이벤트 필요
2. **F-04 연동**: 페이지 탐색(뒤로/앞으로) 시에도 로딩 인디케이터 동작
3. **F-10 연동**: 로딩 실패 시 에러 페이지로 전환

## 5. 용어 정의

| 용어 | 정의 |
|------|------|
| 프로그레스바 (ProgressBar) | 로딩 진행률을 수평 막대로 표시하는 UI 요소 (0~100%) |
| 스피너 (Spinner) | 회전 애니메이션으로 로딩 중임을 표시하는 UI 요소 |
| 가상 진행률 | 실제 로딩 진행률을 알 수 없을 때 시간 기반으로 계산한 추정 진행률 |
| 오버레이 (Overlay) | WebView 위에 겹쳐서 표시되는 UI 레이어 (z-index 높음) |
| Ease-out | 초반 빠르고 후반 느려지는 애니메이션 가속도 곡선 |
| 페이드아웃 (Fade-out) | 불투명도를 점차 감소시켜 사라지는 애니메이션 효과 |

## 6. 범위 외 (Out of Scope)

### 이번 기능에서 하지 않는 것
- **실제 로딩 진행률 추출**: iframe의 제약으로 불가능, 가상 진행률만 구현
- **로딩 취소 기능**: F-04에서 구현 예정 (뒤로 버튼으로 네비게이션 취소)
- **로딩 통계 수집**: 페이지별 평균 로딩 시간 통계는 F-08(히스토리)에서 고려
- **네트워크 속도 표시**: 현재 네트워크 속도 측정 및 표시는 범위 외
- **다운로드 진행률**: 파일 다운로드는 F-12(다운로드 관리)에서 별도 구현

## 7. 완료 기준 (Acceptance Criteria)

### AC-1: 프로그레스바 정상 동작
- [ ] 페이지 로딩 시작 시 프로그레스바가 화면 상단에 표시됨
- [ ] 프로그레스바가 0%에서 시작하여 시간에 따라 증가함
- [ ] 로딩 완료 시 프로그레스바가 100%에 도달 후 0.5초 이내 사라짐
- [ ] 프로그레스바 높이는 8px 이상이며 원거리에서도 명확히 보임

### AC-2: 스피너 정상 동작
- [ ] 페이지 로딩 시작 시 화면 중앙에 스피너가 표시됨
- [ ] 스피너는 부드럽게 회전하며 멈추지 않음 (30fps 이상)
- [ ] 스피너 아래에 "페이지 로딩 중..." 텍스트 표시됨
- [ ] 로딩 완료 시 스피너가 즉시 사라짐

### AC-3: 가상 진행률 알고리즘 작동
- [ ] 로딩 시작 후 3초 이내 60% 도달
- [ ] 로딩 시작 후 10초 경과 시 90% 수준 유지
- [ ] 로딩 완료 이벤트 수신 시 즉시 100% 이동
- [ ] 애니메이션이 자연스럽고 끊기지 않음 (Ease-out 곡선)

### AC-4: 에러 상태 시각적 피드백
- [ ] 로딩 실패 시 프로그레스바가 빨간색으로 변경됨
- [ ] 스피너가 에러 아이콘(⚠️)으로 교체됨
- [ ] 1초간 표시 후 에러 오버레이로 전환됨

### AC-5: 성능 요구사항 충족
- [ ] 프로그레스바 애니메이션이 30fps 이상 유지됨
- [ ] LoadingBar 컴포넌트 메모리 사용량 5MB 이하
- [ ] 로딩 시작 후 100ms 이내 프로그레스바 표시 시작

### AC-6: 다양한 시나리오 테스트
- [ ] 빠른 페이지 로딩 (1초 이내): 프로그레스바가 즉시 100%로 이동 후 사라짐
- [ ] 느린 페이지 로딩 (10초 이상): 프로그레스바가 90%까지만 증가하고 대기
- [ ] 매우 느린 페이지 로딩 (30초 초과): 타임아웃 메시지 표시됨
- [ ] 페이지 로딩 실패 (404): 프로그레스바가 빨간색으로 변경 후 에러 화면 전환
- [ ] 연속 로딩 (탭 전환): 이전 로딩 인디케이터가 정리되고 새 로딩 시작

### AC-7: 리모컨 조작 통합
- [ ] 로딩 중에도 리모컨 Back 버튼으로 로딩 취소 가능 (F-04 연동)
- [ ] 로딩 중 포커스는 WebView 컨테이너에 유지됨

### AC-8: 실제 디바이스 테스트
- [ ] LG 프로젝터 HU175QW에서 프로그레스바가 정상 표시됨
- [ ] 대화면(100인치 이상)에서 3m 거리에서 프로그레스바 시인성 확인
- [ ] 주요 웹사이트(Google, YouTube, Naver) 로딩 시 정상 동작

### AC-9: 코드 품질
- [ ] LoadingBar 컴포넌트 PropTypes 정의 완료
- [ ] ESLint 경고 없음
- [ ] 컴포넌트 문서(docs/components/LoadingBar.md) 작성 완료

## 8. 사용 시나리오

### 시나리오 1: 일반 페이지 로딩
1. 사용자가 URLBar에서 "www.google.com" 입력 후 Enter
2. WebView가 onLoadStart 이벤트 발생
3. **프로그레스바가 화면 상단에 표시**, 0%에서 시작
4. **스피너가 화면 중앙에 표시**, "페이지 로딩 중..." 텍스트
5. 3초 경과: 프로그레스바 60% 도달
6. 5초 경과: WebView가 onLoadEnd 이벤트 발생
7. **프로그레스바가 100%로 즉시 이동** 후 0.5초 페이드아웃
8. **스피너 사라짐**, Google 홈페이지 표시

### 시나리오 2: 느린 네트워크 환경
1. 사용자가 "www.youtube.com" 로딩 시작
2. 프로그레스바 및 스피너 표시
3. 10초 경과: 프로그레스바 90% 도달 후 느리게 증가
4. 30초 경과: **"로딩이 오래 걸리고 있습니다" 메시지 표시**
5. 35초 경과: WebView가 onLoadEnd 이벤트 발생
6. 프로그레스바 100% 이동 후 사라짐

### 시나리오 3: 로딩 실패
1. 사용자가 "http://invalidurl.com" 로딩 시도
2. 프로그레스바 및 스피너 표시
3. 2초 경과: 프로그레스바 30% 도달
4. WebView가 onLoadError 이벤트 발생
5. **프로그레스바가 빨간색으로 변경**, 스피너가 에러 아이콘(⚠️)으로 교체
6. 1초 후 에러 오버레이 표시 (F-02의 ErrorOverlay)

### 시나리오 4: 빠른 페이지 로딩
1. 사용자가 이미 캐시된 "www.google.com" 재로딩
2. 프로그레스바 및 스피너 표시
3. 0.5초 경과: WebView가 onLoadEnd 이벤트 발생 (캐시 히트)
4. 프로그레스바가 60% → 100% 즉시 이동 (가상 진행률 무시)
5. 스피너 즉시 사라짐, 페이지 표시

## 9. 향후 확장 가능성

### F-06 (탭 관리)와의 연동
- 각 탭마다 독립적인 로딩 인디케이터 상태 관리
- 백그라운드 탭 로딩 시 작은 로딩 아이콘만 표시 (프로그레스바 숨김)

### F-11 (설정 화면)과의 연동
- 애니메이션 비활성화 옵션 제공 (모션 감도가 높은 사용자 대응)
- 프로그레스바 스타일 선택 (슬림/굵게)

### 성능 모니터링
- 페이지별 평균 로딩 시간 수집 → 가상 진행률 알고리즘 개선
- 네트워크 속도 측정 기능 추가 고려

## 변경 이력

| 날짜 | 변경 내용 | 이유 |
|------|-----------|------|
| 2026-02-12 | 최초 작성 | F-05 요구사항 분석 시작 |
